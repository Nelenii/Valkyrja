; Town Center
(defrule
    (can-research ri-loom)
    (up-compare-flag vkg_Target_Researches_TownCenter == vkf_Research_TownCenter_Loom)
=>
    (research ri-loom)
)

(defrule
    (can-research-with-escrow feudal-age)
    (up-compare-flag vkg_Target_Researches_TownCenter == vkf_Research_TownCenter_FeudalAge)
=>
    (research feudal-age)
)

(defrule
    (can-research-with-escrow castle-age)
    (up-compare-flag vkg_Target_Researches_TownCenter == vkf_Research_TownCenter_CastleAge)
=>
    (research castle-age)
)

(defrule
    (can-research-with-escrow imperial-age)
    (up-compare-flag vkg_Target_Researches_TownCenter == vkf_Research_TownCenter_ImperialAge)
=>
    (research imperial-age)
)

(defrule
    (can-research ri-town-watch)
    (up-compare-flag vkg_Target_Researches_TownCenter == vkf_Research_TownCenter_TownWatch)
=>
    (research ri-town-watch)
)

(defrule
    (can-research ri-town-patrol)
    (up-compare-flag vkg_Target_Researches_TownCenter == vkf_Research_TownCenter_TownPatrol)
=>
    (research ri-town-patrol)
)

(defrule
    (can-research ri-wheel-barrow)
    (up-compare-flag vkg_Target_Researches_TownCenter == vkf_Research_TownCenter_Wheelbarrow)
=>
    (research ri-wheel-barrow)
)

(defrule
    (can-research ri-hand-cart)
    (up-compare-flag vkg_Target_Researches_TownCenter == vkf_Research_TownCenter_HandCart)
=>
    (research ri-hand-cart)
)


; Mill
(defrule
    (can-research ri-horse-collar)
    (up-compare-flag vkg_Target_Researches_Mill == vkf_Research_Mill_HorseCollar)
=>
    (research ri-horse-collar)
)

(defrule
    (can-research ri-heavy-plow)
    (up-compare-flag vkg_Target_Researches_Mill == vkf_Research_Mill_HeavyPlow)
=>
    (research ri-heavy-plow)
)

(defrule
    (can-research ri-crop-rotation)
    (up-compare-flag vkg_Target_Researches_Mill == vkf_Research_Mill_CropRotation)
=>
    (research ri-crop-rotation)
)


; Lumber Camp
(defrule
    (can-research ri-double-bit-axe)
    (up-compare-flag vkg_Target_Researches_LumberCamp == vkf_Research_LumberCamp_DoubleBitAxe)
=>
    (research ri-double-bit-axe)
)

(defrule
    (can-research ri-bow-saw)
    (up-compare-flag vkg_Target_Researches_LumberCamp == vkf_Research_LumberCamp_BowSaw)
=>
    (research ri-bow-saw)
)

(defrule
    (can-research ri-two-man-saw)
    (up-compare-flag vkg_Target_Researches_LumberCamp == vkf_Research_LumberCamp_TwoManSaw)
=>
    (research ri-two-man-saw)
)


; Mining Camp
(defrule
    (can-research ri-gold-mining)
    (up-compare-flag vkg_Target_Researches_MiningCamp == vkf_Research_MiningCamp_GoldMining)
=>
    (research ri-gold-mining)
)

(defrule
    (can-research ri-gold-shaft-mining)
    (up-compare-flag vkg_Target_Researches_MiningCamp == vkf_Research_MiningCamp_GoldShaftMining)
=>
    (research ri-gold-shaft-mining)
)

(defrule
    (can-research ri-stone-mining)
    (up-compare-flag vkg_Target_Researches_MiningCamp == vkf_Research_MiningCamp_StoneMining)
=>
    (research ri-stone-mining)
)

(defrule
    (can-research ri-stone-shaft-mining)
    (up-compare-flag vkg_Target_Researches_MiningCamp == vkf_Research_MiningCamp_StoneShaftMining)
=>
    (research ri-stone-shaft-mining)
)


; Barracks
(defconst vkg_Target_Researches_Barracks                167)


; Stable
(defconst vkg_Target_Researches_Stable                  169)


; Archery Range
(defconst vkg_Target_Researches_ArcheryRange            168)


; Siege Workshop
(defconst vkg_Target_Researches_SiegeWorkshop           170)


; Castle
(defconst vkg_Target_Researches_Castle                  166)


; Univesity
(defrule
    (can-research ri-masonry)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_Masonry)
=>
    (research ri-masonry)
)

(defrule
    (can-research ri-architecture)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_Architecture)
=>
    (research ri-architecture)
)

(defrule
    (can-research ri-fortified-wall)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_FortifiedWall)
=>
    (research ri-fortified-wall)
)

(defrule
    (can-research ri-guard-tower)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_GuardTower)
=>
    (research ri-guard-tower)
)

(defrule
    (can-research ri-keep)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_Keep)
=>
    (research ri-keep)
)

(defrule
    (can-research ri-ballistics)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_Ballistics)
=>
    (research ri-ballistics)
)

(defrule
    (can-research ri-heated-shot)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_HeatedShot)
=>
    (research ri-heated-shot)
)

(defrule
    (can-research ri-murder-holes)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_MurderHoles)
=>
    (research ri-murder-holes)
)

(defrule
    (can-research ri-stonecutting)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_TreadmillCrane)
=>
    (research ri-stonecutting)
)

(defrule
    (can-research ri-arrowslits)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_Arrowslits)
=>
    (research ri-arrowslits)
)

(defrule
    (can-research ri-siege-engineers)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_SiegeEngineers)
=>
    (research ri-siege-engineers)
)

(defrule
    (can-research ri-chemistry)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_Chemistry)
=>
    (research ri-chemistry)
)

(defrule
    (can-research ri-bombard-tower)
    (up-compare-flag vkg_Target_Researches_University == vkf_Research_University_BombardTower)
=>
    (research ri-bombard-tower)
)


; Monastery
(defrule
    (can-research ri-devotion)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Devotion)
=>
    (research ri-devotion)
)

(defrule
    (can-research ri-faith)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Faith)
=>
    (research ri-faith)
)

(defrule
    (can-research ri-atonement)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Atonement)
=>
    (research ri-atonement)
)

(defrule
    (can-research ri-fervor)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Fervor)
=>
    (research ri-fervor)
)

(defrule
    (can-research ri-herbal-medicine)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_HerbalMedicine)
=>
    (research ri-herbal-medicine)
)

(defrule
    (can-research ri-heresy)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Heresy)
=>
    (research ri-heresy)
)

(defrule
    (can-research ri-redemption)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Redemption)
=>
    (research ri-redemption)
)

(defrule
    (can-research ri-sanctity)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Sanctity)
=>
    (research ri-sanctity)
)

(defrule
    (can-research ri-block-printing)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_BlockPrinting)
=>
    (research ri-block-printing)
)

(defrule
    (can-research ri-illumination)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Illumination)
=>
    (research ri-illumination)
)

(defrule
    (can-research ri-theocracy)
    (up-compare-flag vkg_Target_Researches_Monastery == vkf_Research_Monastery_Theocracy)
=>
    (research ri-theocracy)
)


; Blacksmith
(defrule
    (can-research ri-forging)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_Forging)
=>
    (research ri-forging)
)

(defrule
    (can-research ri-iron-casting)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_IronCasting)
=>
    (research ri-iron-casting)
)

(defrule
    (can-research ri-blast-furnace)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_BlastFurnace)
=>
    (research ri-blast-furnace)
)

(defrule
    (can-research ri-fletching)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_Fletching)
=>
    (research ri-fletching)
)

(defrule
    (can-research ri-bodkin-arrow)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_BodkinArrow)
=>
    (research ri-bodkin-arrow)
)

(defrule
    (can-research ri-bracer)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_Bracer)
=>
    (research ri-bracer)
)

(defrule
    (can-research ri-scale-mail)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_ScaleMail)
=>
    (research ri-scale-mail)
)

(defrule
    (can-research ri-chain-mail)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_ChainMail)
=>
    (research ri-chain-mail)
)

(defrule
    (can-research ri-plate-mail)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_PlateMail)
=>
    (research ri-plate-mail)
)

(defrule
    (can-research ri-padded-archer-armor)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_PaddedArcherArmor)
=>
    (research ri-padded-archer-armor)
)

(defrule
    (can-research ri-leather-archer-armor)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_LeatherArcherArmor)
=>
    (research ri-leather-archer-armor)
)

(defrule
    (can-research ri-ring-archer-armor)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_RingArcherArmor)
=>
    (research ri-ring-archer-armor)
)

(defrule
    (can-research ri-scale-barding)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_ScaleBarding)
=>
    (research ri-scale-barding)
)

(defrule
    (can-research ri-chain-barding)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_Chainbarding)
=>
    (research ri-chain-barding)
)

(defrule
    (can-research ri-plate-barding)
    (up-compare-flag vkg_Target_Researches_Blacksmith == vkf_Research_Blacksmith_PlateBarding)
=>
    (research ri-plate-barding)
)


; Market
(defrule
    (can-research ri-caravan)
    (up-compare-flag vkg_Target_Researches_Market == vkf_Research_Market_Caravan)
=>
    (research ri-caravan)
)

(defrule
    (can-research ri-coinage)
    (up-compare-flag vkg_Target_Researches_Market == vkf_Research_Market_Coinage)
=>
    (research ri-coinage)
)

(defrule
    (can-research ri-banking)
    (up-compare-flag vkg_Target_Researches_Market == vkf_Research_Market_Banking)
=>
    (research ri-banking)
)

(defrule
    (can-research ri-guilds)
    (up-compare-flag vkg_Target_Researches_Market == vkf_Research_Market_Guilds)
=>
    (research ri-guilds)
)


; Dock
(defconst vkg_Target_Researches_Dock                    165)













; Town Center
(defrule
    (current-age == dark-age)
    (up-compare-goal vkg_TargetCount_Age c:>= vkc_FeudalAge)
    (can-research-with-escrow feudal-age)
=>
    (set-goal vkg_TargetCount_Age 2)
    (release-escrow food)
    (research feudal-age)
    (set-goal vkg_TargetCount_Villager 30)
    (set-goal vkg_TargetCount_Farm 10)
    (set-goal vkg_TargetCount_LumberCamp_MuleCart 2)
    (set-goal vkg_TargetCount_GoldMiningCamp_MuleCart 1)
    (set-goal vkg_TargetCount_StoneMiningCamp_MuleCart 1)
    (set-goal vkg_TargetCount_Market 1)
    (set-goal vkg_TargetCount_Blacksmith 1)
    (set-goal vkg_TargetCount_Barracks 1)
    (set-goal vkg_TargetCount_ArcheryRange 1)
    (set-goal vkg_TargetCount_Stable 1)
    (set-strategic-number sn-food-gatherer-percentage 55)
	(set-strategic-number sn-wood-gatherer-percentage 30)
	(set-strategic-number sn-gold-gatherer-percentage 10)
	(set-strategic-number sn-stone-gatherer-percentage 5)
)



(defrule
    (current-age == feudal-age)
    (up-compare-goal vkg_TargetCount_Age c:>= vkc_CastleAge)
    (can-research-with-escrow castle-age)
=>
    (set-goal vkg_TargetCount_Age 3)
    (release-escrow food)
    (release-escrow gold)
    (research castle-age)
    (set-goal vkg_TargetCount_Villager 120)
    (set-goal vkg_TargetCount_Farm 40)
    (set-goal vkg_TargetCount_TownCenter 3)
    (set-goal vkg_TargetCount_LumberCamp_MuleCart 4)
    (set-goal vkg_TargetCount_GoldMiningCamp_MuleCart 2)
    (set-goal vkg_TargetCount_StoneMiningCamp_MuleCart 2)
    (set-goal vkg_TargetCount_Monastery_FortifiedChurch 1)
    (set-goal vkg_TargetCount_University 1)
    (set-goal vkg_TargetCount_SiegeWorkshop 1)
    (set-goal vkg_TargetCount_Castle 1)
    (set-goal vkg_TargetCount_Barracks 3)
    (set-goal vkg_TargetCount_ArcheryRange 3)
    (set-goal vkg_TargetCount_Stable 3)
    (set-strategic-number sn-food-gatherer-percentage 30)
	(set-strategic-number sn-wood-gatherer-percentage 30)
	(set-strategic-number sn-gold-gatherer-percentage 30)
	(set-strategic-number sn-stone-gatherer-percentage 10)
)



(defrule
    (current-age == castle-age)
    (up-compare-goal vkg_TargetCount_Age c:>= vkc_ImperialAge)
    (can-research-with-escrow imperial-age)
=>
    (release-escrow food)
    (release-escrow gold)
    (research imperial-age)
    (set-goal vkg_TargetCount_Villager 200)
)




; test flags
(defconst vkg_TestFlag 500)
(defconst vkf_FirstTest 1)
(defconst vkf_SecondTest 2)
(defconst vkf_ThirdTest 4)


(defrule
    (true)
=>
    (set-goal vkg_TestFlag 0)
    (up-chat-data-to-all "Test Flag = %d"   g: vkg_TestFlag)
    (disable-self)
)

(defrule
    (true)
=>
    ;(up-modify-flag vkg_TestFlag c:- vkf_FirstTest)
    (up-modify-flag vkg_TestFlag c:+ vkf_SecondTest)
    (up-modify-flag vkg_TestFlag c:+ vkf_ThirdTest)
    ;(up-chat-data-to-all "Test Flag = %d"   g: vkg_TestFlag)
)

(defrule
    (up-compare-flag vkg_TestFlag == vkf_ThirdTest)
=>
    ;(up-modify-flag vkg_TestFlag c:- vkf_FirstTest)
    ;(up-modify-flag vkg_TestFlag c:- vkf_SecondTest)
    (chat-to-all "True 3")
)

(defrule
    (up-compare-flag vkg_TestFlag == vkf_SecondTest)
=>
    ;(up-modify-flag vkg_TestFlag c:- vkf_FirstTest)
    ;(up-modify-flag vkg_TestFlag c:- vkf_SecondTest)
    (chat-to-all "True 2")
)
